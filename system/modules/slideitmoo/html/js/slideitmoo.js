/**
 * Class ExtendedSlideItMoo
 *
 * Provide methods to handle slideItMoo slider
 * @copyright  MEN AT WORK 2013
 * @package    slideitmoo
 * @license    GNU/LGPL
 */
(function($){this.ExtendedSlideItMoo=new Class({Implements:[Events,Options],options:{enabled:false,containerId:null,containerChildsId:null,sliderAttr:null,childAttr:null,containerAttr:{overallContainer:{elem:null,styles:{width:null,height:null}},elementScrolled:{elem:null,styles:{width:null,height:null}},thumbsContainer:{elem:null,styles:{width:null,height:null}}},slider:null,elemCount:null,navsSize:{width:0,height:0},responsive:{},resizeTimer:null},initialize:function(options){this.setOptions(options);if($(this.options.containerId)){this.options.enabled=true;document.documentElement.className+=" js-slider";this.options.sliderAttr.transition=eval(this.options.sliderAttr.transition);this.options.elemCount=$$(this.options.containerChildsId).length;this.setItemDimension().setNavSize().setControlsClass();this.options.containerAttr.overallContainer.elem=this.options.sliderAttr.overallContainer;this.options.containerAttr.elementScrolled.elem=this.options.sliderAttr.elementScrolled;this.options.containerAttr.thumbsContainer.elem=this.options.sliderAttr.thumbsContainer}},run:function(){var self=this;if(this.options.enabled){if(this.options.slider===null){this.options.slider=new SlideItMoo(this.options.sliderAttr)}else{this.options.slider.initialize()}if(!this.options.sliderAttr.skipInlineStyles&&!this.options.sliderAttr.isResponsive){this.setPixelStyles()}else{Object.each(this.options.childAttr,function(value,key){self.options.childAttr[key]=null}.bind(self))}if(this.options.sliderAttr.isResponsive){this.setPcentStyles()}if(this.isTouch()){this.addSwipeEvent()}this.setAllContainerStyles().addResizeEvent()}},addEvent:function(type,fn,internal){this.options.slider.addEvent(type,fn,internal)},removeEvent:function(type,fn){this.options.slider.removeEvent(type,fn)},addSwipeEvent:function(){var self=this;if(this.options.contao3){$(this.options.containerId).addEvent("swipe",function(e){(e.direction=="left")?self.options.slider.slide(1):self.options.slider.slide(-1)})}else{var func=function(event){if(event.direction==="left"){self.options.slider.slide(1)}else{if(event.direction==="right"){self.options.slider.slide(-1)}}};if(this.options.elemCount>this.options.sliderAttr.itemsVisible){$(this.options.containerId).addEvent("swipe",func);$(this.options.containerId).store("swipe:distance",20);$(this.options.containerId).store("swipe:cancelVertical",true)}else{$(this.options.containerId).removeEvents("swipe")}}},isTouch:function(){return"ontouchstart" in window},setItemDimension:function(){if(this.options.sliderAttr.isResponsive){var elementScrolledPxWidth=$(this.options.sliderAttr.elementScrolled).getWidth();var elementScrolledPxHeight=$(this.options.sliderAttr.elementScrolled).getHeight();this.options.responsive.thumbsContainer={pcent:{width:((this.options.elemCount*100)/this.options.sliderAttr.itemsVisible),height:((this.options.elemCount*100)/this.options.sliderAttr.itemsVisible)},pixel:{width:((this.options.elemCount*elementScrolledPxWidth)/this.options.sliderAttr.itemsVisible),height:((this.options.elemCount*elementScrolledPxHeight)/this.options.sliderAttr.itemsVisible)}};this.options.responsive.child={pcent:{width:(100/this.options.elemCount),height:(100/this.options.elemCount)},pixel:{width:(this.options.responsive.thumbsContainer.pixel.width/this.options.elemCount),height:(this.options.responsive.thumbsContainer.pixel.height/this.options.elemCount)}};this.options.sliderAttr.itemWidth=this.options.responsive.child.pixel.width.round(2);this.options.sliderAttr.itemHeight=this.options.responsive.child.pixel.height.round(2)}else{if(!this.options.sliderAttr.itemWidth||this.options.sliderAttr.skipInlineStyles){this.options.sliderAttr.itemWidth=$$(this.options.containerChildsId)[0].getComputedSize().totalWidth;this.options.sliderAttr.itemHeight=$$(this.options.containerChildsId)[0].getComputedSize().totalHeight}}return this},setNavSize:function(){if(this.options.sliderAttr.showControls&&!this.options.sliderAttr.skipNavSize){var fwdSize=$(this.options.sliderAttr.overallContainer).getElement(this.options.sliderAttr.navs.fwd).getSize(),bkSize=$(this.options.sliderAttr.overallContainer).getElement(this.options.sliderAttr.navs.bk).getSize();this.options.navsSize={width:fwdSize.x+bkSize.x,height:fwdSize.y+bkSize.y}}return this},setControlsClass:function(){if(this.options.elemCount<=this.options.sliderAttr.itemsVisible&&this.options.sliderAttr.showControls){$(this.options.sliderAttr.overallContainer).getElement(this.options.sliderAttr.navs.fwd).addClass("hidden");$(this.options.sliderAttr.overallContainer).getElement(this.options.sliderAttr.navs.bk).addClass("hidden")}else{$(this.options.sliderAttr.overallContainer).getElement(this.options.sliderAttr.navs.fwd).removeClass("hidden");$(this.options.sliderAttr.overallContainer).getElement(this.options.sliderAttr.navs.bk).removeClass("hidden")}return this},setPixelStyles:function(){if(this.options.sliderAttr.slideVertical){this.options.containerAttr.overallContainer.styles.height=(this.options.sliderAttr.itemsVisible*this.options.sliderAttr.itemHeight+this.options.navsSize.height).round(2);this.options.containerAttr.elementScrolled.styles.height=(this.options.sliderAttr.itemsVisible*this.options.sliderAttr.itemHeight).round(2);this.options.containerAttr.thumbsContainer.styles.height=(this.options.elemCount*this.options.sliderAttr.itemHeight+10).round(2)}else{this.options.containerAttr.overallContainer.styles.width=(this.options.sliderAttr.itemsVisible*this.options.sliderAttr.itemWidth+this.options.navsSize.width).round(2);this.options.containerAttr.elementScrolled.styles.width=(this.options.sliderAttr.itemsVisible*this.options.sliderAttr.itemWidth).round(2);this.options.containerAttr.thumbsContainer.styles.width=(this.options.elemCount*this.options.sliderAttr.itemWidth+10).round(2)}return this},setPcentStyles:function(){var self=this;if(this.options.sliderAttr.slideVertical){this.options.containerAttr.thumbsContainer.styles.height=(this.options.responsive.thumbsContainer.pcent.height).round(2)+"%";Object.each(this.options.childAttr,function(value,key){self.options.childAttr.height=(this.options.responsive.child.pcent.height).round(10)+"%"}.bind(self))}else{this.options.containerAttr.thumbsContainer.styles.width=(this.options.responsive.thumbsContainer.pcent.width).round(2)+"%";Object.each(this.options.childAttr,function(value,key){self.options.childAttr.width=(this.options.responsive.child.pcent.width).round(10)+"%"}.bind(self))}},setAllContainerStyles:function(){Object.each(this.options.containerAttr,function(e){if($(e.elem)){$(e.elem).setStyles(e.styles);if($(e.elem).get("style")===""){$(e.elem).removeAttribute("style")}}});$$(this.options.containerChildsId).setStyles(this.options.childAttr);return this},setContainerStyles:function(container,objStyles){if($(container)&&!!Object.getLength(objStyles)){Object.each(objStyles,function(value,key){$(container).setStyle(key,value)})}return this},addResizeEvent:function(){window.addEvent("resize",function(){if(this.options.slider.options.autoSlide){this.options.slider.stopAutoSlide()}clearTimeout(this.options.resizeTimer);this.options.resizeTimer=(function(){this.setItemDimension();this.options.slider.elementWidth=this.options.sliderAttr.itemWidth;this.options.slider.elementHeight=this.options.sliderAttr.itemHeight;if(this.options.slider.options.autoSlide){this.options.slider.startAutoSlide()}}.bind(this)).delay(50)}.bind(this))},rebuildFramework:function(){if(this.options.slider.options.autoSlide){this.options.slider.stopAutoSlide()}this.options.elemCount=$$(this.options.containerChildsId).length;this.setItemDimension().setNavSize().setControlsClass();this.run();if(this.options.slider.options.autoSlide){this.options.slider.startAutoSlide()}}})})(document.id);