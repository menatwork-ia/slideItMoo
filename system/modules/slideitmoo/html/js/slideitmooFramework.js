/**
 * Class SlideItMoo
 *
 * Image slider for MooTools
 * @copyright  Constantin Boiangiu 2007-2010
 * @copyright  MEN AT WORK 2012
 * @copyright  c.schiffler 2012
 * @license    MIT-style
 */
(function(a){this.SlideItMoo=new Class({Implements:[Events,Options],options:{overallContainer:null,elementScrolled:null,thumbsContainer:null,itemsSelector:null,itemsVisible:5,elemsSlide:null,itemWidth:null,itemHeight:null,navs:{fwd:".SlideItMoo_forward",bk:".SlideItMoo_back"},slideVertical:false,showControls:1,transition:Fx.Transitions.linear,duration:800,direction:1,autoSlide:false,mouseWheelNav:false,startIndex:null,showBullets:false,bulletContainer:null,bulletNumbers:false},initialize:function(b){this.setOptions(b);this.elements=a(this.options.thumbsContainer).getElements(this.options.itemsSelector);this.totalElements=this.elements.length;if(this.totalElements<=this.options.itemsVisible){return}var c=this.elements[0].getSize();this.elementWidth=this.options.itemWidth||c.x;this.elementHeight=this.options.itemHeight||c.y;this.currentElement=0;this.direction=this.options.direction;this.autoSlideTotal=this.options.autoSlide+this.options.duration;if(this.options.elemsSlide==1){this.options.elemsSlide=null}this.bulletContainer=a(this.options.bulletContainer||this.options.overallContainer);this.begin()},begin:function(){this.addControls();this.setContainersSize();this.myFx=new Fx.Tween(this.options.thumbsContainer,{property:(this.options.slideVertical?"margin-top":"margin-left"),link:"ignore",transition:this.options.transition,duration:this.options.duration});if(this.options.mouseWheelNav){a(this.options.thumbsContainer).addEvent("mousewheel",function(c){new Event(c).stop();this.slide(-c.wheel)}.bind(this))}if(this.options.startIndex&&this.options.startIndex>0&&this.options.startIndex<this.elements.length){for(var b=1;b<=this.options.startIndex;b++){this.rearange()}}if(this.options.showBullets){this.buildBullets();this.updateBullets()}if(this.options.autoSlide&&this.elements.length>this.options.itemsVisible){this.startAutoSlide()}},resetAll:function(){a(this.options.overallContainer).removeProperty("style");a(this.options.elementScrolled).removeProperty("style");a(this.options.thumbsContainer).removeProperty("style");this.stopAutoSlide();if(typeOf(this.fwd)!==null){this.fwd.dispose();this.bkwd.dispose()}if(typeOf(this.bulletlist)!==null){this.bulletlist.dispose();this.bullets.each(function(b){b.dispose()});delete (this.bullets)}this.initialize()},setContainersSize:function(){var g={};var f={};var c={};if(this.options.slideVertical){f.height=this.options.itemsVisible*this.elementHeight;c.height=this.totalElements*(parseInt(this.elementHeight)+10)}else{var e=0;if(this.options.showControls){var d=this.fwd.getSize();var b=this.bkwd.getSize();e=d.x+b.x}g.width=this.options.itemsVisible*this.elementWidth+e;f.width=this.options.itemsVisible*this.elementWidth;c.width=this.totalElements*(this.elementWidth+10)}a(this.options.overallContainer).set({styles:g});a(this.options.elementScrolled).set({styles:f});a(this.options.thumbsContainer).set({styles:c})},addControls:function(){if(!this.options.showControls||this.elements.length<=this.options.itemsVisible){return}this.fwd=a(this.options.overallContainer).getElement(this.options.navs.fwd);this.bkwd=a(this.options.overallContainer).getElement(this.options.navs.bk);if(this.fwd){this.fwd.addEvent("click",this.slide.pass(1,this))}if(this.bkwd){this.bkwd.addEvent("click",this.slide.pass(-1,this))}},slide:function(e){if(this.started){return}this.direction=e?e:this.direction;var b=this.currentIndex();if(((this.options.elemsSlide&&this.options.elemsSlide>1)||this.moveBy)&&this.endingElem==null){this.endingElem=this.currentElement;var f=this.moveBy?this.moveBy:this.options.elemsSlide;for(var c=0;c<f;c++){this.endingElem+=e;if(this.endingElem>=this.totalElements){this.endingElem=0}if(this.endingElem<0){this.endingElem=this.totalElements-1}}}var d={};var j=0;var h=0;var g=0;if(this.options.slideVertical){d["margin-top"]=-this.elementHeight;g=-this.elementHeight}else{d["margin-left"]=-this.elementWidth;g=-this.elementWidth}if(this.direction==1){h=g;j=0}else{h=0;j=g}if(this.direction==-1){this.rearange();a(this.options.thumbsContainer).setStyles(d)}this.started=true;if(!typeOf(this.endingElem)){this.endingElem=null}this.myFx.start(j,h).chain(function(){this.rearange(true);if(this.options.elemsSlide||this.moveBy){if(this.endingElem!==this.currentElement){if(this.options.autoSlide){this.stopAutoSlide()}this.slide(this.direction)}else{if(this.options.autoSlide){this.startAutoSlide()}this.endingElem=null;delete (this.moveBy)}}}.bind(this));this.fireEvent("onChange",b);if(this.options.showBullets){this.updateBullets(b)}},rearange:function(b){if(b){this.started=false}if(b&&this.direction==-1){return}this.currentElement=this.currentIndex(this.direction);var c={};if(this.options.slideVertical){c["margin-top"]=0}else{c["margin-left"]=0}a(this.options.thumbsContainer).setStyles(c);if(this.currentElement==1&&this.direction==1){this.elements[0].inject(this.elements[this.totalElements-1],"after");return}if((this.currentElement==0&&this.direction==1)||(this.direction==-1&&this.currentElement==this.totalElements-1)){this.rearrangeElement(this.elements.getLast(),this.direction==1?this.elements[this.totalElements-2]:this.elements[0]);return}if(this.direction==1){this.rearrangeElement(this.elements[this.currentElement-1],this.elements[this.currentElement-2])}else{this.rearrangeElement(this.elements[this.currentElement],this.elements[this.currentElement+1])}},rearrangeElement:function(c,b){this.direction==1?c.inject(b,"after"):c.inject(b,"before")},currentIndex:function(){var b=null;switch(this.direction){case 1:b=this.currentElement>=this.totalElements-1?0:this.currentElement+this.direction;break;case -1:b=this.currentElement==0?this.totalElements-1:this.currentElement+this.direction;break}return b},startAutoSlide:function(){this.startIt=this.slide.bind(this).pass(this.options.direction|1);this.autoSlide=this.startIt.periodical(this.autoSlideTotal,this);this.isRunning=true;this.elements.addEvents({mouseenter:function(){clearInterval(this.autoSlide);this.isRunning=false}.bind(this),mouseleave:function(){this.autoSlide=this.startIt.periodical(this.autoSlideTotal,this);this.isRunning=true}.bind(this)})},stopAutoSlide:function(){clearInterval(this.autoSlide);clearInterval(this.startIt);this.isRunning=false;this.elements.removeEvents()},buildBullets:function(){var e=this;this.bulletlist=new Element("ul",{"class":"bulletlist"}).inject(this.bulletContainer);this.bullets=[];var d=this;if(this.options.elemsSlide==this.options.itemsVisible&&this.isInt(this.totalElements/this.options.elemsSlide)){this.options.bulletCount=this.totalElements/this.options.elemsSlide;this.options.multiply=this.options.elemsSlide}else{this.options.bulletCount=this.totalElements;this.options.multiply=1}for(var c=0;c<this.options.bulletCount;c++){var b=new Element("li",{"class":"bullet item"+((c+1)*this.options.multiply)}).inject(this.bulletlist,"bottom").store("idx",c*this.options.multiply).store("list",d);b.addEvent("click",this.clicked.pass(b,this));if(this.options.bulletNumbers){if(this.currentElement==c){b.adopt(new Element("span",{html:c+1}))}else{b.adopt(new Element("a",{html:c+1}))}}this.bullets.push(b)}this.bullets[this.currentElement].addClass("active")},clicked:function(d){if(this.started||this.targetSlide){return}clearInterval(this.autoSlide);var b=d.retrieve("idx"),e=b-this.currentElement,c=(e>0?1:-1);if(e==0){return}this.moveBy=e*c;this.slide(c)},updateBullets:function(c){var b=((typeof c!="undefined")?c:this.currentElement);if(this.options.multiply!=1&&b!=0){b=b/this.options.multiply}this.bullets.each(function(f,d){if(d==b){if(this.options.bulletNumbers){new Element("span",{html:f.getChildren()[0].get("html")}).replaces(f.getChildren()[0])}f.addClass("active")}else{if(this.options.bulletNumbers){new Element("a",{html:f.getChildren()[0].get("html")}).replaces(f.getChildren()[0])}f.removeClass("active")}}.bind(this))},isInt:function(b){if((parseFloat(b)==parseInt(b))&&!isNaN(b)){return true}else{return false}}})})(document.id);